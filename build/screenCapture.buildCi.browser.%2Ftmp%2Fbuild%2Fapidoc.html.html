<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/nitoyon/livereloadx#readme">livereloadx (v0.3.9)</a>
</h1>
<h4>An implementation of the LiveReload 2 server in Node.js</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx">module livereloadx</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.livereloadx">
            function <span class="apidocSignatureSpan"></span>livereloadx
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy">
            function <span class="apidocSignatureSpan">livereloadx.</span>proxy
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.static">
            function <span class="apidocSignatureSpan">livereloadx.</span>static
            <span class="apidocSignatureSpan">(config, onError)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.toString">
            function <span class="apidocSignatureSpan">livereloadx.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.watcher">
            function <span class="apidocSignatureSpan">livereloadx.</span>watcher
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket">
            function <span class="apidocSignatureSpan">livereloadx.</span>websocket
            <span class="apidocSignatureSpan">(config, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>config</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>filter</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>html</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>proxy.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>server</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>static.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>watcher.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">livereloadx.</span>websocket.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.config">module livereloadx.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.config.dump">
            function <span class="apidocSignatureSpan">livereloadx.config.</span>dump
            <span class="apidocSignatureSpan">(log, conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.config.parseArgv">
            function <span class="apidocSignatureSpan">livereloadx.config.</span>parseArgv
            <span class="apidocSignatureSpan">(argv)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.config.setDefaultValue">
            function <span class="apidocSignatureSpan">livereloadx.config.</span>setDefaultValue
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.config.validate">
            function <span class="apidocSignatureSpan">livereloadx.config.</span>validate
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.filter">module livereloadx.filter</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.filter.Filter">
            function <span class="apidocSignatureSpan">livereloadx.filter.</span>Filter
            <span class="apidocSignatureSpan">(filter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.filter.getMatcher">
            function <span class="apidocSignatureSpan">livereloadx.filter.</span>getMatcher
            <span class="apidocSignatureSpan">(filters)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.html">module livereloadx.html</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.html.inject">
            function <span class="apidocSignatureSpan">livereloadx.html.</span>inject
            <span class="apidocSignatureSpan">(buffer, port)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.livereloadx">module livereloadx.livereloadx</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.livereloadx.livereloadx">
            function <span class="apidocSignatureSpan">livereloadx.</span>livereloadx
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.proxy">module livereloadx.proxy</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy.proxy">
            function <span class="apidocSignatureSpan">livereloadx.</span>proxy
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.proxy.prototype">module livereloadx.proxy.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy.prototype.doProxy">
            function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>doProxy
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy.prototype.handle">
            function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>handle
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy.prototype.init">
            function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.proxy.prototype.onError">
            function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>onError
            <span class="apidocSignatureSpan">(req, res, err)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.server">module livereloadx.server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.server.LiveReloadJsHandler">
            function <span class="apidocSignatureSpan">livereloadx.server.</span>LiveReloadJsHandler
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.server.Server">
            function <span class="apidocSignatureSpan">livereloadx.server.</span>Server
            <span class="apidocSignatureSpan">(config, watcher)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.server.createServer">
            function <span class="apidocSignatureSpan">livereloadx.server.</span>createServer
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.static">module livereloadx.static</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.static.static">
            function <span class="apidocSignatureSpan">livereloadx.</span>static
            <span class="apidocSignatureSpan">(config, onError)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.static.super_">
            function <span class="apidocSignatureSpan">livereloadx.static.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.static.prototype">module livereloadx.static.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.static.prototype.handle">
            function <span class="apidocSignatureSpan">livereloadx.static.prototype.</span>handle
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.static.prototype.sendWithInjection">
            function <span class="apidocSignatureSpan">livereloadx.static.prototype.</span>sendWithInjection
            <span class="apidocSignatureSpan">(path, stat, stream)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.toString">module livereloadx.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.toString.toString">
            function <span class="apidocSignatureSpan">livereloadx.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.watcher">module livereloadx.watcher</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.watcher.watcher">
            function <span class="apidocSignatureSpan">livereloadx.</span>watcher
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.watcher.super_">
            function <span class="apidocSignatureSpan">livereloadx.watcher.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.watcher.prototype">module livereloadx.watcher.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.watcher.prototype.watch">
            function <span class="apidocSignatureSpan">livereloadx.watcher.prototype.</span>watch
            <span class="apidocSignatureSpan">(dir, is_included)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.websocket">module livereloadx.websocket</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.websocket">
            function <span class="apidocSignatureSpan">livereloadx.</span>websocket
            <span class="apidocSignatureSpan">(config, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.livereloadx.websocket.prototype">module livereloadx.websocket.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.prototype.close">
            function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.prototype.onClose">
            function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onClose
            <span class="apidocSignatureSpan">(socket, remoteAddress)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.prototype.onConnection">
            function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onConnection
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.prototype.onMessage">
            function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onMessage
            <span class="apidocSignatureSpan">(socket, message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.livereloadx.websocket.prototype.send">
            function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>send
            <span class="apidocSignatureSpan">(file, msg)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx" id="apidoc.module.livereloadx">module livereloadx</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.livereloadx" id="apidoc.element.livereloadx.livereloadx">
        function <span class="apidocSignatureSpan"></span>livereloadx
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">livereloadx = function (grunt) {

  grunt.registerTask('livereloadx', 'LiveReloadX server', function() {
    // initialize log
    var log_mod = require('../lib/log')
      , config_mod = require('../lib/config');
    log_mod.cli = true;
    if (grunt.option('debug') || grunt.option('verbose')) {
      log_mod.verbose = true;
    }

    // initialize wait
    var config = grunt.config(this.name);
    if ('wait' in config) {
      if (config['wait']) {
        // never go to next task
        this.async();
      }
      // delete wait property because config_mod report it as invalid
      delete config['wait'];
    }

    // get config
    var log = log_mod('grunt');
    try {
      config = config_mod.setDefaultValue(config);
      config_mod.dump(log.info.bind(log), config);
    } catch (e) {
      grunt.log.error(e);
      return false;
    }

    // start server
    var server = require('../')(config);
    server.listen().watch();
    grunt.log.writeln('LiveReloadX started.');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.proxy" id="apidoc.element.livereloadx.proxy">
        function <span class="apidocSignatureSpan">livereloadx.</span>proxy
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ProxyHandler(config) {
  this.config = config;
  this.init();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.static" id="apidoc.element.livereloadx.static">
        function <span class="apidocSignatureSpan">livereloadx.</span>static
        <span class="apidocSignatureSpan">(config, onError)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StaticHandler(config, onError) {
  this.config = config;
  this.onError = onError;
  this.root = require('path').resolve(this.config.dir);

  if (this.config.static) {
    log.info("Enabled static mode.");
  }
  log.debug('root dir: %s', this.root);

  EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.toString" id="apidoc.element.livereloadx.toString">
        function <span class="apidocSignatureSpan">livereloadx.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  oldBuf.length, newBuf.length);
return newBuf;
};

ServerResponseWrapper.prototype.finish = function(buffer) {
// set Content-Length header
// `res.setHeader()` is necessary for logging Content-Length in server.js
this.headers['content-length'] = buffer.length.<span class="apidocCodeKeywordSpan">toString</span>();
this.res.setHeader('Content-Length', buffer.length.toString());

log.debug('%s: finish', this.req.url);
log.debug('  - header: ', this.headers);
this.origWriteHead.call(this.res, this.statusCode, this.headers);
this.origWrite.call(this.res, buffer);
this.origEnd.call(this.res);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.watcher" id="apidoc.element.livereloadx.watcher">
        function <span class="apidocSignatureSpan">livereloadx.</span>watcher
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Watcher() {
  EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.websocket" id="apidoc.element.livereloadx.websocket">
        function <span class="apidocSignatureSpan">livereloadx.</span>websocket
        <span class="apidocSignatureSpan">(config, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function WebSocketHandler(config, options) {
  this.config = config;
  this.clients = [];

  this.wsServer = new WebSocketServer(options);
  this.wsServer.on('connection', this.onConnection.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.config" id="apidoc.module.livereloadx.config">module livereloadx.config</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.config.dump" id="apidoc.element.livereloadx.config.dump">
        function <span class="apidocSignatureSpan">livereloadx.config.</span>dump
        <span class="apidocSignatureSpan">(log, conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dump = function (log, conf) {
  log('Config:');
  log('  - mode:   %s', conf.static ? 'static' : conf.proxy !== '' ? 'proxy' : 'default');
  if (conf.proxy) {
    log('    url:  %s', conf.proxy);
    log('    prefer local: %s', conf.preferLocal ? 'ON' : 'OFF');
  }
  log('  - port:   %d', conf.port);
  log('  - filter:');
  conf.filter.forEach(function(filter, i) {
    log('    %d: %s "%s"', i + 1, filter.type, filter.pattern);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  delete config['wait'];
}

// get config
var log = log_mod('grunt');
try {
  config = config_mod.setDefaultValue(config);
  config_mod.<span class="apidocCodeKeywordSpan">dump</span>(log.info.bind(log), config);
} catch (e) {
  grunt.log.error(e);
  return false;
}

// start server
var server = require('../')(config);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.config.parseArgv" id="apidoc.element.livereloadx.config.parseArgv">
        function <span class="apidocSignatureSpan">livereloadx.config.</span>parseArgv
        <span class="apidocSignatureSpan">(argv)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseArgv = function (argv) {
  // set default value
  copyValues(program, defaultValues);

  // HACK: avoid commander.js's bug
  // (https://github.com/visionmedia/commander.js/pull/121)
  // program.parse() doesn't fail when unknown option and args are given.
  // So we call program.parseOptions() instead of program.parse().
  program._name = 'livereloadx';
  var parsed = program.parseOptions(program.normalize(argv.slice(2)));
  program.args = parsed.args;

  // handle unknown options
  if (parsed.unknown.length &gt; 0) {
    program.parseArgs([], parsed.unknown);
  }

  // handle &lt;dir&gt;
  if (program.args.length === 1) {
    program.dir = program.args[0];
  } else if (program.args.length === 0) {
    program.dir = '.';
  } else if (program.args.length &gt; 1) {
    throw "Too much arguments";
  }

  // delete include and exclude
  delete program.include;
  delete program.exclude;

  // copy program to Object
  return validate(copyValues({}, program));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.config.setDefaultValue" id="apidoc.element.livereloadx.config.setDefaultValue">
        function <span class="apidocSignatureSpan">livereloadx.config.</span>setDefaultValue
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDefaultValue = function (conf) {
  for (var key in defaultValues) {
    if (!(key in conf)) {
      // deep copy
      conf[key] = JSON.parse(JSON.stringify(defaultValues[key]));
    }
  }
  return validate(conf);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    res.statusCode,
    res._headers &amp;&amp; res._headers['content-length'] || '-');
};
}


function Server(config, watcher) {
this.config = require('./config').<span class="apidocCodeKeywordSpan">setDefaultValue</span>(config);
this.is_included = require('./filter').getMatcher(this.config.filter);
this.watcher = watcher || new Watcher();
}

Server.prototype = {
listen: function() {
  var self = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.config.validate" id="apidoc.element.livereloadx.config.validate">
        function <span class="apidocSignatureSpan">livereloadx.config.</span>validate
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validate = function (conf) {
  for (var key in conf) {
    if (!(key in defaultValues)) {
      throw "Invalid key: " + key;
    }
    if (typeof defaultValues[key] !== typeof conf[key]) {
      throw "Invalid type: " + key + " should be " + typeof defaultValues[key];
    }
    if (typeof conf[key] === 'number' &amp;&amp; isNaN(conf[key])) {
      throw "Invalid value: " + key + " should be a number";
    }

    if (conf.static &amp;&amp; conf.proxy !== '') {
      throw 'The "static" option cannot be specified together with "proxy" option';
    }
    if (conf.preferLocal &amp;&amp; conf.proxy === '') {
      throw 'The "prefer-local" option must be specified with "proxy" option';
    }
  }
  return conf;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.filter" id="apidoc.module.livereloadx.filter">module livereloadx.filter</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.filter.Filter" id="apidoc.element.livereloadx.filter.Filter">
        function <span class="apidocSignatureSpan">livereloadx.filter.</span>Filter
        <span class="apidocSignatureSpan">(filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Filter(filter) {
  // validate type
  if (filter.type !== 'include' &amp;&amp; filter.type !== 'exclude') {
    throw new Error('Invalid filter type: ' + filter.type);
  }

  this.pattern = filter.pattern;
  this.type = filter.type;
  this.is_include = (filter.type === 'include');
  this.is_exclude = !this.is_include;
  this.parse();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.filter.getMatcher" id="apidoc.element.livereloadx.filter.getMatcher">
        function <span class="apidocSignatureSpan">livereloadx.filter.</span>getMatcher
        <span class="apidocSignatureSpan">(filters)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMatcher(filters) {
  filters = filters.map(function(f) { return new Filter(f); });

  return function match(file) {
    var dirs = file.split('/');
    log.trace('%s: filtering start', file);
    for (var i = 0, len = dirs.length; i &lt; len; i++) {
      var name = dirs.slice(0, i + 1).join('/')
        , is_dir = (i &lt; len - 1);

      for (var j = 0, filterLen = filters.length; j &lt; filterLen; j++) {
        if (filters[j].match(name, is_dir)) {
          if (filters[j].is_include) {
            log.trace('%s: include filter %d matches (%s)', name, j, filters[j].re.source);
            break;
          } else {
            log.trace('%s: exclude filter %d matches (%s)', name, j, filters[j].re.source);
            return false;
          }
        }
      }
      if (j === filterLen) {
        log.trace('%s: no filter matches', name);
      }
    }
    log.trace('%s: included', file);
    return true;
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    res._headers &amp;&amp; res._headers['content-length'] || '-');
};
}


function Server(config, watcher) {
this.config = require('./config').setDefaultValue(config);
this.is_included = require('./filter').<span class="apidocCodeKeywordSpan">getMatcher</span>(this.config.filter);
this.watcher = watcher || new Watcher();
}

Server.prototype = {
listen: function() {
  var self = this;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.html" id="apidoc.module.livereloadx.html">module livereloadx.html</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.html.inject" id="apidoc.element.livereloadx.html.inject">
        function <span class="apidocSignatureSpan">livereloadx.html.</span>inject
        <span class="apidocSignatureSpan">(buffer, port)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">inject = function (buffer, port) {
  // create snippet code
  var snippet = "&lt;script&gt;document.write('&lt;script src=\"http://' + (location.host || 'localhost').split(':')[0] + ':" +
      port + "/livereload.js?snipver=2&amp;port=" + port + "\"&gt;&lt;/' + 'script&gt;')&lt;/script&gt;";

  // find embed position
  var pos = bufLastSearchBody(buffer);

  var ret = new Buffer(buffer.length + snippet.length);
  if (pos &gt;= 0) {
    log.debug('insert snippet at %d', pos);
    buffer.copy(ret, 0, 0, pos);
    ret.write(snippet, pos);
    buffer.copy(ret, pos + snippet.length, pos);
  } else {
    log.debug('append snippet');
    buffer.copy(ret);
    ret.write(snippet, buffer.length);
  }

  return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.livereloadx" id="apidoc.module.livereloadx.livereloadx">module livereloadx.livereloadx</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.livereloadx.livereloadx" id="apidoc.element.livereloadx.livereloadx.livereloadx">
        function <span class="apidocSignatureSpan">livereloadx.</span>livereloadx
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">livereloadx = function (grunt) {

  grunt.registerTask('livereloadx', 'LiveReloadX server', function() {
    // initialize log
    var log_mod = require('../lib/log')
      , config_mod = require('../lib/config');
    log_mod.cli = true;
    if (grunt.option('debug') || grunt.option('verbose')) {
      log_mod.verbose = true;
    }

    // initialize wait
    var config = grunt.config(this.name);
    if ('wait' in config) {
      if (config['wait']) {
        // never go to next task
        this.async();
      }
      // delete wait property because config_mod report it as invalid
      delete config['wait'];
    }

    // get config
    var log = log_mod('grunt');
    try {
      config = config_mod.setDefaultValue(config);
      config_mod.dump(log.info.bind(log), config);
    } catch (e) {
      grunt.log.error(e);
      return false;
    }

    // start server
    var server = require('../')(config);
    server.listen().watch();
    grunt.log.writeln('LiveReloadX started.');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.proxy" id="apidoc.module.livereloadx.proxy">module livereloadx.proxy</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.proxy.proxy" id="apidoc.element.livereloadx.proxy.proxy">
        function <span class="apidocSignatureSpan">livereloadx.</span>proxy
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ProxyHandler(config) {
  this.config = config;
  this.init();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.proxy.prototype" id="apidoc.module.livereloadx.proxy.prototype">module livereloadx.proxy.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.proxy.prototype.doProxy" id="apidoc.element.livereloadx.proxy.prototype.doProxy">
        function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>doProxy
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">doProxy = function (req, res) {
  // rewrite location header
  wrapRewriteLocation(req, res, this.proxy);

  // hook response
  wrapResponse(req, res, this.config.port);

  // pass to http-proxy
  log.debug("process: %s", req.url);
  this.proxy.proxyRequest(req, res);
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (this.staticHandler) {
  if (this.staticHandler.handle(req, res)) {
    return true;
  }
}

this.<span class="apidocCodeKeywordSpan">doProxy</span>(req, res);
return true;
};

ProxyHandler.prototype.doProxy = function(req, res) {
// rewrite location header
wrapRewriteLocation(req, res, this.proxy);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.proxy.prototype.handle" id="apidoc.element.livereloadx.proxy.prototype.handle">
        function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>handle
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (req, res) {
  if (!this.proxy) {
    return false;
  }

  if (this.staticHandler) {
    if (this.staticHandler.handle(req, res)) {
      return true;
    }
  }

  this.doProxy(req, res);
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

ProxyHandler.prototype.handle = function(req, res) {
  if (!this.proxy) {
    return false;
  }

  if (this.staticHandler) {
    if (this.staticHandler.<span class="apidocCodeKeywordSpan">handle</span>(req, res)) {
      return true;
    }
  }

  this.doProxy(req, res);
  return true;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.proxy.prototype.init" id="apidoc.element.livereloadx.proxy.prototype.init">
        function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function () {
  log.debug('proxy: ', this.config.proxy);
  if (this.config.proxy === '') {
    return;
  }

  var proxyUrl = url.parse(this.config.proxy);
  if (!proxyUrl.protocol) {
    throw new Error("proxy URL protocol is not specified:" + this.config.proxy);
  }

  // create HttpProxy instance
  var isHttps = (proxyUrl.protocol === 'https:');
  var port = proxyUrl.port || (isHttps ? 443 : 80);
  if (!isHttps &amp;&amp; proxyUrl.protocol !== 'http:') {
    throw new Error("proxy URL protocol is invalid: " + this.config.proxy);
  }
  if (proxyUrl.path !== '/') {
    log.warn("proxy URL path '%s' is ignored", proxyUrl.path);
  }
  this.proxy = new httpProxy.HttpProxy({
    target: {
      host: proxyUrl.hostname,
      port: port,
      https: isHttps
    },
    enable: {
      xforward: false
    },
    changeOrigin: true
  });

  // create StaticHandler instance if prefer-local is enabled
  if (this.config.preferLocal) {
    this.staticHandler = new StaticHandler(this.config, this.onError.bind(this));
  }

  log.info("Enabled proxy mode. (proxy to '%s//%s:%d/')", proxyUrl.protocol,
    proxyUrl.hostname, port);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }
  return writeHead.call(this, statusCode, headers);
};
}

function ProxyHandler(config) {
this.config = config;
this.<span class="apidocCodeKeywordSpan">init</span>();
}

ProxyHandler.prototype.init = function() {
log.debug('proxy: ', this.config.proxy);
if (this.config.proxy === '') {
  return;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.proxy.prototype.onError" id="apidoc.element.livereloadx.proxy.prototype.onError">
        function <span class="apidocSignatureSpan">livereloadx.proxy.prototype.</span>onError
        <span class="apidocSignatureSpan">(req, res, err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onError = function (req, res, err) {
  if (err.status === 404) {
    // If file not found on local dir, retrieve from remote server
    log.debug("%s: not found on local. load from remote.", req.url);
    this.doProxy(req, res);
  } else {
    // unknown error
    // (ref) connect/lib/proto.js

    // default to 500
    if (res.statusCode &lt; 400) { res.statusCode = 500; }

    // respect err.status
    if (err.status) { res.statusCode = err.status; }

    // gets a basic error message
    var msg = err.stack || err.toString();
    log.error('Failed to read from local: %s, %s', this.req.url, msg);

    if (res.headerSent) { return req.socket.destroy(); }
    res.setHeader('Content-Type', 'text/plain');
    res.setHeader('Content-Length', Buffer.byteLength(msg));
    if ('HEAD' === req.method) { return res.end(); }
    res.end(msg);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    self.sendWithInjection(path, stat, this);
  };
}

// Set error callback
if (this.onError) {
  sendStream.on('error', function(err) {
    self.<span class="apidocCodeKeywordSpan">onError</span>(req, res, err);

    // replay end &amp; data events
    // (ref) connect/lib/middlewares/static.js
    //       https://gist.github.com/mikedeboer/3047099
    _pause.resume();
  });
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.server" id="apidoc.module.livereloadx.server">module livereloadx.server</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.server.LiveReloadJsHandler" id="apidoc.element.livereloadx.server.LiveReloadJsHandler">
        function <span class="apidocSignatureSpan">livereloadx.server.</span>LiveReloadJsHandler
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function LiveReloadJsHandler() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.server.Server" id="apidoc.element.livereloadx.server.Server">
        function <span class="apidocSignatureSpan">livereloadx.server.</span>Server
        <span class="apidocSignatureSpan">(config, watcher)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Server(config, watcher) {
  this.config = require('./config').setDefaultValue(config);
  this.is_included = require('./filter').getMatcher(this.config.filter);
  this.watcher = watcher || new Watcher();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.server.createServer" id="apidoc.element.livereloadx.server.createServer">
        function <span class="apidocSignatureSpan">livereloadx.server.</span>createServer
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createServer = function (config) {
  log.debug("createServer", config);
  var server = new Server(config || {});
  return server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var handlers = [ new LiveReloadJsHandler() ];
    if (this.config.proxy) {
handlers.push(new ProxyHandler(this.config));
    } else if (this.config.static) {
handlers.push(new StaticHandler(this.config));
    }

    var server = http.<span class="apidocCodeKeywordSpan">createServer</span>(function(request, response) {
addLogger(request, response);

for (var i = 0; i &lt; handlers.length; i++) {
  if (handlers[i].handle(request, response)) {
    return;
  }
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.static" id="apidoc.module.livereloadx.static">module livereloadx.static</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.static.static" id="apidoc.element.livereloadx.static.static">
        function <span class="apidocSignatureSpan">livereloadx.</span>static
        <span class="apidocSignatureSpan">(config, onError)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StaticHandler(config, onError) {
  this.config = config;
  this.onError = onError;
  this.root = require('path').resolve(this.config.dir);

  if (this.config.static) {
    log.info("Enabled static mode.");
  }
  log.debug('root dir: %s', this.root);

  EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.static.super_" id="apidoc.element.livereloadx.static.super_">
        function <span class="apidocSignatureSpan">livereloadx.static.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.static.prototype" id="apidoc.module.livereloadx.static.prototype">module livereloadx.static.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.static.prototype.handle" id="apidoc.element.livereloadx.static.prototype.handle">
        function <span class="apidocSignatureSpan">livereloadx.static.prototype.</span>handle
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handle = function (req, res) {
  if ('GET' !== req.method &amp;&amp; 'HEAD' !== req.method) { return false; }

  var path = url.parse(req.url).pathname;
  var _pause = pause(req);
  var self = this;

  log.debug('path: %s', path);
  var sendStream = send(req, path, {root: this.root});

  if (path.match(/(\/|\.html?)$/)) {
    // hook SendStream.send()
    sendStream.send = function(path, stat) {
      // HTML -&gt; call sendWithInjection()
      self.sendWithInjection(path, stat, this);
    };
  }

  // Set error callback
  if (this.onError) {
    sendStream.on('error', function(err) {
      self.onError(req, res, err);

      // replay end &amp; data events
      // (ref) connect/lib/middlewares/static.js
      //       https://gist.github.com/mikedeboer/3047099
      _pause.resume();
    });
  }

  sendStream
    .on('end', function() { log.debug('end'); self.emit('end'); })
    .pipe(res);
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

ProxyHandler.prototype.handle = function(req, res) {
  if (!this.proxy) {
    return false;
  }

  if (this.staticHandler) {
    if (this.staticHandler.<span class="apidocCodeKeywordSpan">handle</span>(req, res)) {
      return true;
    }
  }

  this.doProxy(req, res);
  return true;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.static.prototype.sendWithInjection" id="apidoc.element.livereloadx.static.prototype.sendWithInjection">
        function <span class="apidocSignatureSpan">livereloadx.static.prototype.</span>sendWithInjection
        <span class="apidocSignatureSpan">(path, stat, stream)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendWithInjection = function (path, stat, stream) {
  // read file to end
  var self = this;
  fs.readFile(path, function(err, data) {
    if (err) {
      stream.error(500, err);
      return;
    }

    // set header
    stream.setHeader(path, stat);
    stream.res.setHeader('Content-Type', 'text/html');

    // inject snippet
    var buffer = inject(data, self.config.port);

    // write to stream
    stream.res.setHeader('Content-Length', buffer.length);
    stream.res.write(buffer);
    stream.res.end();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
log.debug('path: %s', path);
var sendStream = send(req, path, {root: this.root});

if (path.match(/(\/|\.html?)$/)) {
  // hook SendStream.send()
  sendStream.send = function(path, stat) {
    // HTML -&gt; call sendWithInjection()
    self.<span class="apidocCodeKeywordSpan">sendWithInjection</span>(path, stat, this);
  };
}

// Set error callback
if (this.onError) {
  sendStream.on('error', function(err) {
    self.onError(req, res, err);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.toString" id="apidoc.module.livereloadx.toString">module livereloadx.toString</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.toString.toString" id="apidoc.element.livereloadx.toString.toString">
        function <span class="apidocSignatureSpan">livereloadx.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  oldBuf.length, newBuf.length);
return newBuf;
};

ServerResponseWrapper.prototype.finish = function(buffer) {
// set Content-Length header
// `res.setHeader()` is necessary for logging Content-Length in server.js
this.headers['content-length'] = buffer.length.<span class="apidocCodeKeywordSpan">toString</span>();
this.res.setHeader('Content-Length', buffer.length.toString());

log.debug('%s: finish', this.req.url);
log.debug('  - header: ', this.headers);
this.origWriteHead.call(this.res, this.statusCode, this.headers);
this.origWrite.call(this.res, buffer);
this.origEnd.call(this.res);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.watcher" id="apidoc.module.livereloadx.watcher">module livereloadx.watcher</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.watcher.watcher" id="apidoc.element.livereloadx.watcher.watcher">
        function <span class="apidocSignatureSpan">livereloadx.</span>watcher
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Watcher() {
  EventEmitter.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.watcher.super_" id="apidoc.element.livereloadx.watcher.super_">
        function <span class="apidocSignatureSpan">livereloadx.watcher.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.watcher.prototype" id="apidoc.module.livereloadx.watcher.prototype">module livereloadx.watcher.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.watcher.prototype.watch" id="apidoc.element.livereloadx.watcher.prototype.watch">
        function <span class="apidocSignatureSpan">livereloadx.watcher.prototype.</span>watch
        <span class="apidocSignatureSpan">(dir, is_included)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">watch = function (dir, is_included) {
  var self = this;

  var filter = {
    matches: function() { return true; },
    excludes: function(path) {
      path = path.replace(/\\/g, '/') + '/';
      if (is_included(path)) {
        log.debug("  watching '%s'", path);
        return false;
      } else {
        log.debug("  skipping '%s'", path);
        return true;
      }
    }
  };

  var watcher = fsmonitor.watch(dir, filter, function(change) {
    log.debug("Change %s", change);
    change.modifiedFiles.concat(change.addedFiles).forEach(function(file) {
      self.emit("change", file.replace(/\\/g, '/'));
    });
  });

  log.info('Watching "%s"...', require('path').resolve(dir));
  return watcher;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (this.webSocket) {
  this.webSocket.send(file, msg);
}
  },

  watch: function() {
this.watcher.<span class="apidocCodeKeywordSpan">watch</span>(this.config.dir, this.is_included);

var self = this;
this.watcher.on('change', function(file) {
  if (self.is_included(file)) {
    if (self.config.delay === 0) {
      self.notifyFileChange(file);
    } else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.websocket" id="apidoc.module.livereloadx.websocket">module livereloadx.websocket</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.websocket.websocket" id="apidoc.element.livereloadx.websocket.websocket">
        function <span class="apidocSignatureSpan">livereloadx.</span>websocket
        <span class="apidocSignatureSpan">(config, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function WebSocketHandler(config, options) {
  this.config = config;
  this.clients = [];

  this.wsServer = new WebSocketServer(options);
  this.wsServer.on('connection', this.onConnection.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.livereloadx.websocket.prototype" id="apidoc.module.livereloadx.websocket.prototype">module livereloadx.websocket.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.livereloadx.websocket.prototype.close" id="apidoc.element.livereloadx.websocket.prototype.close">
        function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  this.wsServer.close();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.clients.length &gt; 2 ? 's' : '');
  this.clients.forEach(function(socket) {
    socket.send(msg);
  });
},

close: function() {
  this.wsServer.<span class="apidocCodeKeywordSpan">close</span>();
},

onConnection: function(socket) {
  log.debug("on connection");
  var remoteAddress = "(unknown)";
  var self = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.websocket.prototype.onClose" id="apidoc.element.livereloadx.websocket.prototype.onClose">
        function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onClose
        <span class="apidocSignatureSpan">(socket, remoteAddress)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onClose = function (socket, remoteAddress) {
  log.debug("on close");
  log.info("%s - websocket connection closed", remoteAddress);

  var i = this.clients.indexOf(socket);
  if (i &gt;= 0) {
    this.clients.splice(i, 1);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  this.clients.push(socket);

  socket.on('message', function(message) {
    self.onMessage(socket, message);
  });
  socket.on('close', function() {
    self.<span class="apidocCodeKeywordSpan">onClose</span>(socket, remoteAddress);
  });
},

onMessage: function(socket, message) {
  log.debug("on message: %s", message);
  var msg = JSON.parse(message);
  if (msg.command === 'hello') {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.websocket.prototype.onConnection" id="apidoc.element.livereloadx.websocket.prototype.onConnection">
        function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onConnection
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onConnection = function (socket) {
  log.debug("on connection");
  var remoteAddress = "(unknown)";
  var self = this;

  if (socket._socket) {
    remoteAddress = socket._socket.remoteAddress;
  }
  log.info("%s - new connection to websocket server", remoteAddress);

  this.clients.push(socket);

  socket.on('message', function(message) {
    self.onMessage(socket, message);
  });
  socket.on('close', function() {
    self.onClose(socket, remoteAddress);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.websocket.prototype.onMessage" id="apidoc.element.livereloadx.websocket.prototype.onMessage">
        function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>onMessage
        <span class="apidocSignatureSpan">(socket, message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onMessage = function (socket, message) {
  log.debug("on message: %s", message);
  var msg = JSON.parse(message);
  if (msg.command === 'hello') {
    socket.send(JSON.stringify({
      command: 'hello',
      protocols: [
        'http://livereload.com/protocols/official-7'
      ],
      serverName: 'livereloadx'
    }));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    remoteAddress = socket._socket.remoteAddress;
  }
  log.info("%s - new connection to websocket server", remoteAddress);

  this.clients.push(socket);

  socket.on('message', function(message) {
    self.<span class="apidocCodeKeywordSpan">onMessage</span>(socket, message);
  });
  socket.on('close', function() {
    self.onClose(socket, remoteAddress);
  });
},

onMessage: function(socket, message) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.livereloadx.websocket.prototype.send" id="apidoc.element.livereloadx.websocket.prototype.send">
        function <span class="apidocSignatureSpan">livereloadx.websocket.prototype.</span>send
        <span class="apidocSignatureSpan">(file, msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (file, msg) {
  log.info("notify: %s (%d client)", file, this.clients.length,
    this.clients.length &gt; 2 ? 's' : '');
  this.clients.forEach(function(socket) {
    socket.send(msg);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  command: 'reload',
  path: file,
  liveCSS: this.config.liveCSS,
  liveImg: this.config.liveImg
});

if (this.webSocket) {
  this.webSocket.<span class="apidocCodeKeywordSpan">send</span>(file, msg);
}
  },

  watch: function() {
this.watcher.watch(this.config.dir, this.is_included);

var self = this;
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>